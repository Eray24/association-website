<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <title>YÃ¶netim - Dernek Websitesi</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="navbar">
      <div class="logo">
        <a href="index.html" class="logo-link">UFUK DERNEÄÄ°</a>
      </div>
      <div class="navbar-search">
        <label for="site-search" class="sr-only">Sitede ara</label>
        <input id="site-search" type="search" placeholder="Sitede ara" aria-label="Sitede ara" autocomplete="off" />
        <div id="search-results" class="search-results" style="display:none;"></div>
      </div>
      <nav>
        <a href="index.html">Ana Sayfa</a>
        <a href="about.html">HakkÄ±mÄ±zda</a>
        <a href="management.html">YÃ¶netim</a>
        <a href="announcements.html">Duyurular</a>
        <a href="activities.html">Faaliyetlerimiz</a>
        <a href="contact.html">Ä°letiÅŸim</a>
        <button id="theme-toggle" class="theme-toggle">ğŸŒ™</button>
        <a href="login.html" class="login" id="userLoginBtn">GiriÅŸ Yap</a>
      </nav>
    </header>

    <section class="management-hero">
      <h1>YÃ¶netim Kurulu</h1>
      <p>DerneÄŸimizi yÃ¶neten baÅŸarÄ±lÄ± ekibimizi tanÄ±yÄ±n</p>
      <div
        data-admin-only
        style="
          display: none;
          margin-top: 20px;
          padding: 15px;
          background: #e5e7eb;
          border-radius: 8px;
          color: #374151;
        "
      >
        <strong>Admin Paneli:</strong> Admin olarak giriÅŸ yaptÄ±nÄ±z. Sistem
        yÃ¶netim araÃ§larÄ±na eriÅŸebilirsiniz.
      </div>
    </section>

    <section class="management-content">
      <div id="team-grid" class="team-grid"></div>

      <div data-admin-only style="display: none; margin-top: 40px; padding: 30px; background: #e7f3ff; border: 2px solid #0066cc; border-radius: 12px;">
        <h2 style="color: #0066cc; margin-top: 0;">Admin YÃ¶netim AlanÄ±</h2>
        <p><strong>Sistem Kontrol Paneli</strong></p>
        <ul>
          <li>Toplam kayÄ±tlÄ± kullanÄ±cÄ± sayÄ±sÄ±: <span id="totalUsers">0</span></li>
          <li>Admin sayÄ±sÄ±: <span id="adminCount">0</span></li>
          <li>Ãœye sayÄ±sÄ±: <span id="memberCount">0</span></li>
        </ul>
        <button id="logoutBtn" style="background: #d32f2f; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">Ã‡Ä±kÄ±ÅŸ Yap</button>

        <div id="admin-team-manager" style="margin-top:20px; background:#fff; padding:16px; border-radius:8px; display:none;">
          <h3 style="margin:0 0 10px 0;">YÃ¶netim Ãœyelerini YÃ¶net</h3>
          <form id="teamForm" style="display:grid; grid-template-columns:1fr 1fr; gap:8px; align-items:center;">
            <input type="text" id="avatar" placeholder="Avatar (emoji veya simge)" />
            <input type="text" id="name" placeholder="Ä°sim Soyisim" />
            <input type="text" id="position" placeholder="Pozisyon" />
            <input type="text" id="contact" placeholder="E-posta / Ä°letiÅŸim" />
            <textarea id="bio" placeholder="KÄ±sa biyografi" style="grid-column:1/3; height:80px;"></textarea>
            <input type="hidden" id="editIndex" />
            <div style="grid-column:1/3; display:flex; gap:8px;">
              <button type="button" id="addBtn" style="background:#0066cc;color:white;border:none;padding:8px 12px;border-radius:6px;">Ekle</button>
              <button type="button" id="saveBtn" style="background:#2e7d32;color:white;border:none;padding:8px 12px;border-radius:6px;display:none;">GÃ¼ncelle</button>
              <button type="button" id="cancelBtn" style="background:#777;color:white;border:none;padding:8px 12px;border-radius:6px;display:none;">Ä°ptal</button>
            </div>
          </form>
        </div>

        <div id="admin-members-list" style="margin-top:30px; background:#fff; padding:20px; border-radius:8px; display:none;">
          <h3 style="margin:0 0 15px 0; color:#0066cc;">KayÄ±tlÄ± Ãœyeler</h3>
          <div id="membersList" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:16px;"></div>
        </div>
      </div>

      <div data-member-only style="display: none; margin-top: 40px; padding: 30px; background: #e8f5e9; border: 2px solid #2e7d32; border-radius: 12px;">
        <h2 style="color: #2e7d32; margin-top: 0;">Ãœye Bilgileri</h2>
        <p><strong>Sizin Oturum Bilgileriniz</strong></p>
        <p id="memberInfo">Bilgiler yÃ¼kleniyor...</p>
        <button id="logoutBtnMember" style="background: #2e7d32; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">Ã‡Ä±kÄ±ÅŸ Yap</button>
      </div>
    </section>

    <script>
      // Admin ve member alanlarÄ± iÃ§in kullanÄ±cÄ± bilgileri gÃ¶ster
      document.addEventListener("DOMContentLoaded", () => {
        const su = JSON.parse(sessionStorage.getItem("user") || "null");

        if (su && su.role === "admin") {
          try {
            const users = JSON.parse(localStorage.getItem("users") || "[]");
            document.getElementById("totalUsers").textContent = users.length;
            document.getElementById("adminCount").textContent = users.filter((u) => u.role === "admin").length;
            document.getElementById("memberCount").textContent = users.filter((u) => u.role === "member").length;
          } catch {}
        }

        if (su && (su.role === "member" || su.role === "admin")) {
          document.getElementById("memberInfo").textContent =
            `AdÄ±: ${su.firstName} ${su.lastName} | E-posta: ${su.email} | Rol: ${su.role}`;
        }

        // Admin team manager visibility
        if (su && su.role === 'admin') {
          const manager = document.getElementById('admin-team-manager');
          if (manager) manager.style.display = 'block';
          const membersList = document.getElementById('admin-members-list');
          if (membersList) membersList.style.display = 'block';
          renderMembers();
        }

        // Render members list for admin
        function renderMembers() {
          if (!(su && su.role === 'admin')) return;
          const membersContainer = document.getElementById('membersList');
          if (!membersContainer) return;
          
          const users = JSON.parse(localStorage.getItem('users') || '[]');
          const donations = JSON.parse(localStorage.getItem('donations') || '[]');
          
          membersContainer.innerHTML = '';
          
          // Admin kendini gÃ¶rmemeli - sadece diÄŸer kullanÄ±cÄ±larÄ± gÃ¶ster
          const filteredUsers = users.filter(user => user.email !== su.email);
          
          filteredUsers.forEach((user, idx) => {
            const userDonations = donations.filter(d => d.email === user.email);
            const totalDonation = userDonations.reduce((sum, d) => sum + (parseFloat(d.amount) || 0), 0);
            
            const card = document.createElement('div');
            card.style.cssText = 'background:#f9fafb; border:1px solid #e5e7eb; border-radius:8px; padding:16px; position:relative;';
            
            const roleColor = user.role === 'admin' ? '#0066cc' : '#2e7d32';
            const roleBadge = user.role === 'admin' ? 'ğŸ‘‘ Admin' : 'ğŸ‘¤ Ãœye';
            
            card.innerHTML = `
              <div style="display:flex; align-items:center; gap:12px; margin-bottom:12px;">
                <div style="width:48px; height:48px; background:#e5e7eb; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:24px;">
                  ${user.role === 'admin' ? 'ğŸ‘‘' : 'ğŸ‘¤'}
                </div>
                <div style="flex:1;">
                  <h4 style="margin:0; color:#1f2937; font-size:16px;">${user.firstName} ${user.lastName}</h4>
                  <p style="margin:2px 0 0 0; color:${roleColor}; font-size:13px; font-weight:600;">${roleBadge}</p>
                </div>
              </div>
              <div style="font-size:13px; color:#6b7280; line-height:1.6;">
                <p style="margin:4px 0;"><strong>ğŸ“§ E-posta:</strong> ${user.email}</p>
                <p style="margin:4px 0;"><strong>ğŸ“ Telefon:</strong> ${user.phone || 'BelirtilmemiÅŸ'}</p>
                <p style="margin:4px 0;"><strong>ğŸ’° Toplam BaÄŸÄ±ÅŸ:</strong> <span style="color:#2e7d32; font-weight:600;">${totalDonation.toFixed(2)} â‚º</span></p>
                <p style="margin:4px 0;"><strong>ğŸ“Š BaÄŸÄ±ÅŸ SayÄ±sÄ±:</strong> ${userDonations.length}</p>
              </div>
            `;
            
            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'Sil';
            deleteBtn.style.cssText = 'margin-top:12px; background:#d32f2f; color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-weight:600; width:100%;';
            // Orijinal users dizisindeki indexi bul
            const originalIdx = users.findIndex(u => u.email === user.email);
            deleteBtn.onclick = () => deleteMemberUser(originalIdx, user.email);
            card.appendChild(deleteBtn);
            
            membersContainer.appendChild(card);
          });
        }

        function deleteMemberUser(idx, email) {
          if (!(su && su.role === 'admin')) {
            alert('Yetkiniz yok!');
            return;
          }
          
          if (!confirm(`Bu Ã¼yeyi silmek istediÄŸinizden emin misiniz?\n\nE-posta: ${email}\n\nNot: Bu iÅŸlem geri alÄ±namaz!`)) {
            return;
          }
          
          try {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            users.splice(idx, 1);
            localStorage.setItem('users', JSON.stringify(users));
            
            // Update counts
            document.getElementById("totalUsers").textContent = users.length;
            document.getElementById("adminCount").textContent = users.filter((u) => u.role === "admin").length;
            document.getElementById("memberCount").textContent = users.filter((u) => u.role === "member").length;
            
            renderMembers();
            alert('Ãœye baÅŸarÄ±yla silindi!');
          } catch (e) {
            alert('Ãœye silinirken bir hata oluÅŸtu!');
            console.error(e);
          }
        }

        // Team management
        const defaultTeam = [
          {avatar:'ğŸ‘”', name:'Ali Zengin', position:'BaÅŸkan', bio:'15 yÄ±llÄ±k sosyal giriÅŸimcilik deneyimi. Toplumsal deÄŸiÅŸim ve dayanÄ±ÅŸmaya inanÄ±r.', contact:'ali@dernek.org'},
          {avatar:'ğŸ‘”', name:'Eray SarÄ±baÅŸ', position:'BaÅŸkan', bio:'DerneÄŸin stratejik kararlarÄ±nda aktif rol oynayan, vizyoncu lider.', contact:'eray@dernek.org'},
          {avatar:'ğŸ“‹', name:'Fatma Kara', position:'Genel Sekreteri', bio:'DerneÄŸin gÃ¼nlÃ¼k operasyonlarÄ±ndan sorumlu. Kurucu Ã¼yelerden biri.', contact:'fatma@dernek.org'},
          {avatar:'ğŸ’°', name:'Mehmet Demir', position:'Mali Ä°ÅŸler MÃ¼dÃ¼rÃ¼', bio:'Muhasebe ve bÃ¼tÃ§e yÃ¶netiminde uzman. Finansal ÅŸeffaflÄ±ÄŸÄ±n savunucusu.', contact:'mehmet@dernek.org'},
          {avatar:'ğŸ¯', name:'Zeynep AydÄ±n', position:'Projeleri KoordinatÃ¶rÃ¼', bio:'Sosyal projeler ve etkinliklerin yÃ¶neticisi. GÃ¶nÃ¼llÃ¼lÃ¼k hareketinin lideri.', contact:'zeynep@dernek.org'},
          {avatar:'ğŸŒ', name:'Ä°brahim Ã‡alÄ±k', position:'Toplum Ä°liÅŸkileri MÃ¼dÃ¼rÃ¼', bio:'DÄ±ÅŸ kurumlarla iÅŸbirliÄŸi ve yÃ¶netim. AÄŸ oluÅŸturma uzmanÄ±.', contact:'ibrahim@dernek.org'},
          {avatar:'ğŸ“±', name:'GÃ¼l Yavuz', position:'Dijital Medya MÃ¼dÃ¼rÃ¼', bio:'Sosyal medya ve web varlÄ±ÄŸÄ±ndan sorumlu. Ä°letiÅŸim stratejisti.', contact:'gul@dernek.org'}
        ];

        function getTeam() {
          try { return JSON.parse(localStorage.getItem('team')) || defaultTeam.slice(); } catch { return defaultTeam.slice(); }
        }

        let team = getTeam();
        const teamGrid = document.getElementById('team-grid');

        function renderTeam() {
          if (!teamGrid) return;
          // ensure grid is visible for all visitors
          teamGrid.style.display = '';
          teamGrid.innerHTML = '';
          const currentUser = JSON.parse(sessionStorage.getItem('user') || 'null');
          team.forEach((m, idx) => {
            const card = document.createElement('div');
            card.className = 'team-member';
            card.innerHTML = `\n              <div class="member-avatar">${m.avatar || 'ğŸ™‚'}</div>\n              <h3>${m.name || ''}</h3>\n              <p class="position">${m.position || ''}</p>\n              <p class="bio">${m.bio || ''}</p>\n              <p class="contact">ğŸ“§ ${m.contact || ''}</p>\n            `;
            if (currentUser && currentUser.role === 'admin') {
              const controls = document.createElement('div');
              controls.style.marginTop = '8px';
              const editBtn = document.createElement('button');
              editBtn.textContent = 'DÃ¼zenle';
              editBtn.style.marginRight = '8px';
              editBtn.onclick = () => startEdit(idx);
              const delBtn = document.createElement('button');
              delBtn.textContent = 'Sil';
              delBtn.style.background = '#d32f2f';
              delBtn.style.color = 'white';
              delBtn.onclick = () => deleteMember(idx);
              controls.appendChild(editBtn);
              controls.appendChild(delBtn);
              card.appendChild(controls);
            }
            teamGrid.appendChild(card);
          });
          // show/hide admin manager according to current session
          const manager = document.getElementById('admin-team-manager');
          if (manager) manager.style.display = (currentUser && currentUser.role === 'admin') ? 'block' : 'none';
        }

        function saveTeam() {
          localStorage.setItem('team', JSON.stringify(team));
          renderTeam();
        }

        function startEdit(i) {
          const m = team[i];
          document.getElementById('avatar').value = m.avatar || '';
          document.getElementById('name').value = m.name || '';
          document.getElementById('position').value = m.position || '';
          document.getElementById('bio').value = m.bio || '';
          document.getElementById('contact').value = m.contact || '';
          document.getElementById('editIndex').value = i;
          document.getElementById('addBtn').style.display = 'none';
          document.getElementById('saveBtn').style.display = 'inline-block';
          document.getElementById('cancelBtn').style.display = 'inline-block';
        }

        function deleteMember(i) {
          if (!(su && su.role === 'admin')) { alert('Yetkiniz yok'); return; }
          if (!confirm('Bu Ã¼yeyi silmek istediÄŸinizden emin misiniz?')) return;
          team.splice(i,1);
          saveTeam();
        }

        document.getElementById('addBtn')?.addEventListener('click', () => {
          if (!(su && su.role === 'admin')) { alert('Yetkiniz yok'); return; }
          const m = {
            avatar: document.getElementById('avatar').value.trim() || 'ğŸ™‚',
            name: document.getElementById('name').value.trim(),
            position: document.getElementById('position').value.trim(),
            bio: document.getElementById('bio').value.trim(),
            contact: document.getElementById('contact').value.trim()
          };
          if (!m.name) { alert('LÃ¼tfen isim girin'); return; }
          team.push(m);
          saveTeam();
          document.getElementById('teamForm').reset();
        });

        document.getElementById('saveBtn')?.addEventListener('click', () => {
          if (!(su && su.role === 'admin')) { alert('Yetkiniz yok'); return; }
          const idx = parseInt(document.getElementById('editIndex').value,10);
          if (isNaN(idx)) return;
          team[idx] = {
            avatar: document.getElementById('avatar').value.trim() || 'ğŸ™‚',
            name: document.getElementById('name').value.trim(),
            position: document.getElementById('position').value.trim(),
            bio: document.getElementById('bio').value.trim(),
            contact: document.getElementById('contact').value.trim()
          };
          document.getElementById('teamForm').reset();
          document.getElementById('editIndex').value = '';
          document.getElementById('addBtn').style.display = 'inline-block';
          document.getElementById('saveBtn').style.display = 'none';
          document.getElementById('cancelBtn').style.display = 'none';
          saveTeam();
        });

        document.getElementById('cancelBtn')?.addEventListener('click', () => {
          document.getElementById('teamForm').reset();
          document.getElementById('editIndex').value = '';
          document.getElementById('addBtn').style.display = 'inline-block';
          document.getElementById('saveBtn').style.display = 'none';
          document.getElementById('cancelBtn').style.display = 'none';
        });

        renderTeam();

        // Keep team visible after navigation / tab focus
        window.addEventListener('pageshow', () => renderTeam());
        window.addEventListener('load', () => renderTeam());
        document.addEventListener('visibilitychange', () => {
          if (document.visibilityState === 'visible') renderTeam();
        });

        // If navigation uses client-side routing or the link is clicked, ensure render
        document.querySelectorAll('a[href="management.html"]').forEach(a => {
          a.addEventListener('click', () => setTimeout(() => { if (location.pathname.split('/').pop() === 'management.html') renderTeam(); }, 250));
        });
      });
    </script>
    </section>

    <footer class="site-footer">
      <div class="footer-top">
        <div class="footer-brand">
          <h3>Ufuk DerneÄŸi</h3>
          <p>Ufuk DerneÄŸi; eÄŸitim, saÄŸlÄ±k, sosyal yardÄ±m ve Ã§evre projeleriyle toplumsal dayanÄ±ÅŸmayÄ± gÃ¼Ã§lendiren gÃ¶nÃ¼llÃ¼lÃ¼k temelli bir sivil oluÅŸumdur.</p>
          <div class="footer-social">
            <a href="#" aria-label="X" class="footer-social-link">ğ•</a>
            <a href="#" aria-label="Facebook" class="footer-social-link">f</a>
            <a href="#" aria-label="Instagram" class="footer-social-link">ğŸ“·</a>
            <a href="#" aria-label="LinkedIn" class="footer-social-link">in</a>
            <a href="#" aria-label="YouTube" class="footer-social-link">â–¶</a>
          </div>
        </div>

        <div class="footer-columns">
          <div class="footer-column">
            <h4>Kurumsal</h4>
            <a href="about.html">HakkÄ±mÄ±zda</a>
            <a href="management.html">YÃ¶netim</a>
            <a href="activities.html">Faaliyetlerimiz</a>
            <a href="announcements.html">Duyurular</a>
          </div>
          <div class="footer-column">
            <h4>Destek</h4>
            <a href="contact.html">Ä°letiÅŸim</a>
            <a href="index.html#bagis">BaÄŸÄ±ÅŸ</a>
            <a href="register.html">Ãœye Ol</a>
            <a href="login.html">GiriÅŸ Yap</a>
          </div>
        </div>

        <div class="footer-contact">
          <h4>Ä°letiÅŸim</h4>
          <ul>
            <li><span class="footer-icon">ğŸ“</span>0 (312) 310 10 10</li>
            <li><span class="footer-icon">ğŸ“§</span>info@ufukdernegi.org</li>
            <li><span class="footer-icon">ğŸ“</span>Ankara, TÃ¼rkiye</li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom">
        <p>Ufuk DerneÄŸi Â© 2025. TÃ¼m haklarÄ± saklÄ±dÄ±r.</p>
        <div class="footer-bottom-links">
          <a href="contact.html">Bize UlaÅŸÄ±n</a>
          <a href="index.html#bagis">BaÄŸÄ±ÅŸ Yap</a>
        </div>
      </div>
    </footer>

    <script src="script.js"></script>
  </body>
</html>
